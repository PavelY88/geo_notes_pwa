<!DOCTYPE html>
<html lang="ru">
<head>
    <!-- ... остальные метатеги и стили ... -->
</head>
<body>
    <!-- ... остальная разметка ... -->
    
    <button id="installBtn" style="display: none;">
        Установить приложение
    </button>

    <div id="iosInstructions" style="display: none; position: fixed; bottom: 20px; left: 20px; background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.2);">
        Нажмите <img src="share-icon.png" style="height: 20px; vertical-align: middle;"> → "На экран Домой"
        <button onclick="document.getElementById('iosInstructions').style.display = 'none'">×</button>
    </div>

    <script>
        // Универсальная проверка возможности установки
        function isPWAInstallable() {
            return window.matchMedia('(display-mode: standalone)').matches || 
                   window.navigator.standalone ||
                   (window.deferredPrompt !== undefined);
        }

        // Определение iOS/Safari
        function isIOS() {
            return /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        }

        // Определение MIUI браузеров
        function isMiBrowser() {
            return navigator.userAgent.toLowerCase().includes('miui');
        }

        // Показать кнопку установки
        function showInstallButton() {
            const installBtn = document.getElementById('installBtn');
            const iosInstructions = document.getElementById('iosInstructions');
            
            if (isPWAInstallable()) {
                installBtn.style.display = 'none';
                return;
            }

            if (isIOS()) {
                iosInstructions.style.display = 'block';
                installBtn.style.display = 'none';
            } else if (isMiBrowser()) {
                installBtn.style.display = 'block';
                installBtn.onclick = () => {
                    // Специфичная логика для MIUI
                    alert('Нажмите ⋮ в меню браузера → "Добавить на главный экран"');
                };
            } else {
                installBtn.style.display = 'block';
            }
        }

        // Общая логика установки
        let deferredPrompt;

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            showInstallButton();
        });

        document.getElementById('installBtn').addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    console.log('Приложение установлено');
                }
            }
        });

        // Проверка при загрузке
        window.addEventListener('load', () => {
            if (!isPWAInstallable()) {
                showInstallButton();
            }
        });

        // Проверка в фоновом режиме
        setInterval(() => {
            if (isPWAInstallable()) {
                document.getElementById('installBtn').style.display = 'none';
                document.getElementById('iosInstructions').style.display = 'none';
            }
        }, 1000);
    </script>
</body>
</html>
